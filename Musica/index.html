<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY TEMPO | Lumenfall Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'display': ['Impact', 'Arial Black', 'sans-serif'],
                        'mono': ['Courier New', 'monospace'],
                    },
                    colors: {
                        neonCyan: '#00f3ff',
                        neonPink: '#ff00ff',
                        darkBg: '#050505',
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                },
            },
        };
    </script>

    <style>
        body { background-color: #000; color: white; overflow: hidden; }
        
        /* Video de Fondo */
        #canvas-video {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: -1; opacity: 0.5;
            filter: brightness(0.6) contrast(1.2);
            transition: opacity 1s ease;
        }

        /* Contenedor de Letras */
        .lyrics-container {
            height: 50vh; 
            overflow-y: auto;
            /* Máscara para efecto fade arriba/abajo */
            mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent);
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 12rem 0; /* Padding amplio para centrado vertical */
            scroll-behavior: smooth;
        }
        .lyrics-container::-webkit-scrollbar { display: none; }

        /* Estilo Línea Inactiva */
        .lyric-line {
            font-size: 1rem; 
            margin-bottom: 1.5rem; 
            color: #666;
            opacity: 0.4; 
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            line-height: 1.6;
            transform: scale(0.95);
            filter: blur(1.5px);
            cursor: pointer; /* Para permitir click y saltar tiempo */
        }
        
        /* Estilo Línea ACTIVA (Tu estilo solicitado) */
        .lyric-line.active {
            opacity: 1; 
            color: #00f3ff !important;
            text-shadow: 0 0 15px rgba(0, 243, 255, 0.8), 0 0 30px rgba(0, 243, 255, 0.4); 
            transform: scale(1.15); 
            font-weight: bold;
            filter: blur(0px);
        }

        .section-title {
            color: #ff00ff; font-weight: bold; font-size: 0.8rem; margin-top: 3rem; margin-bottom: 1rem; letter-spacing: 0.2em; opacity: 0.8;
        }
        
        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        /* Panel de Control */
        .sync-controls {
            background: rgba(5, 5, 5, 0.9);
            border-top: 1px solid rgba(0, 243, 255, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 -10px 40px rgba(0,0,0,0.8);
        }
    </style>
</head>
<body class="flex flex-col h-screen relative font-mono">

    <!-- Fondo -->
    <video id="canvas-video" autoplay loop muted playsinline>
        <source src="../assets/flama-bg.mp4" type="video/mp4"> 
    </video>

    <!-- Botón Regresar -->
    <a href="../index.html" class="absolute top-6 left-6 text-white/50 hover:text-neonCyan transition z-50 bg-black/20 p-2 rounded-full backdrop-blur-sm">
        <i class="fa-solid fa-arrow-left text-xl"></i>
    </a>

    <!-- Contenido Principal -->
    <div class="flex-grow flex flex-col items-center justify-start px-4 z-10 w-full max-w-md mx-auto mt-4 pt-4">
        
        <!-- Header -->
        <div class="text-center mb-2 fade-in-up flex items-center gap-4 w-full justify-center" style="animation-delay: 0.1s;">
            <div class="w-16 h-16 rounded shadow-[0_0_15px_rgba(0,243,255,0.2)] overflow-hidden border border-white/20">
                <img src="../assets/imagenes/LUMENFALL-JUEGO-512x512.png" onerror="this.src='https://via.placeholder.com/150/000000/00f3ff?text=LF'" class="w-full h-full object-cover">
            </div>
            <div class="text-left">
                <h1 class="font-display text-2xl tracking-widest text-white drop-shadow-lg leading-none">MY TEMPO</h1>
                <p class="text-neonCyan font-mono text-xs tracking-[0.3em]">JOZIEL</p>
            </div>
        </div>

        <!-- Selector Plataforma -->
        <div id="platform-selector" class="w-full mb-4 fade-in-up" style="animation-delay: 0.3s;">
            <p class="text-center text-[10px] text-gray-400 mb-2 uppercase tracking-wider">Elige tu plataforma:</p>
            <div class="grid grid-cols-4 gap-2">
                <button onclick="loadEmbed('spotify')" class="bg-[#1DB954]/20 border border-[#1DB954] hover:bg-[#1DB954] text-white p-2 rounded-lg transition flex justify-center items-center group">
                    <i class="fa-brands fa-spotify text-xl group-hover:text-black"></i>
                </button>
                <button onclick="loadEmbed('apple')" class="bg-[#FA243C]/20 border border-[#FA243C] hover:bg-[#FA243C] text-white p-2 rounded-lg transition flex justify-center items-center group">
                    <i class="fa-brands fa-apple text-xl group-hover:text-black"></i>
                </button>
                <button onclick="loadEmbed('deezer')" class="bg-white/10 border border-white hover:bg-white text-white p-2 rounded-lg transition flex justify-center items-center group">
                    <i class="fa-brands fa-deezer text-xl group-hover:text-black"></i>
                </button>
                <button onclick="loadEmbed('amazon')" class="bg-[#00A8E1]/20 border border-[#00A8E1] hover:bg-[#00A8E1] text-white p-2 rounded-lg transition flex justify-center items-center group">
                    <i class="fa-brands fa-amazon text-xl group-hover:text-black"></i>
                </button>
            </div>
        </div>

        <!-- Reproductor Embed -->
        <div id="player-container" class="w-full hidden fade-in-up mb-2 relative">
            <div class="flex justify-between items-center mb-1 px-1">
                <button onclick="resetPlayer()" class="text-[10px] text-gray-500 hover:text-white uppercase tracking-wider">
                    <i class="fa-solid fa-xmark mr-1"></i> Cerrar
                </button>
                <button id="lang-toggle" onclick="toggleLanguage()" class="text-[10px] border border-neonCyan/50 text-neonCyan bg-black/50 px-3 py-0.5 rounded hover:bg-neonCyan hover:text-black transition uppercase tracking-widest font-bold">
                    EN / ES
                </button>
            </div>
            <div id="embed-frame" class="rounded-xl overflow-hidden shadow-2xl border border-white/10 bg-black transition-all duration-500 min-h-[80px]"></div>
        </div>

        <!-- LYRICS CONTAINER -->
        <div id="lyrics-wrapper" class="w-full relative fade-in-up flex-grow hidden flex flex-col" style="animation-delay: 0.5s;">
            <div id="lyrics-content" class="lyrics-container text-center font-mono text-sm w-full">
                <!-- Se llena con JS -->
            </div>
        </div>
    </div>

    <!-- CONTROLES DE SINCRONIZACIÓN (Fixed Bottom) -->
    <div id="sync-panel" class="fixed bottom-0 left-0 w-full sync-controls p-4 hidden z-50 fade-in-up">
        <div class="max-w-md mx-auto flex flex-col gap-3">
            
            <!-- Barra Progreso -->
            <div class="w-full bg-gray-800 h-1 rounded-full overflow-hidden">
                <div id="progress-bar" class="bg-neonCyan h-full w-0 transition-all duration-200"></div>
            </div>

            <!-- Botonera -->
            <div class="flex items-center justify-between">
                <!-- Ajuste Fino -->
                <div class="flex items-center gap-1">
                    <button onclick="adjustTime(-0.5)" class="text-[10px] bg-gray-800 border border-gray-600 text-white w-8 h-8 rounded hover:border-neonPink hover:text-neonPink active:scale-95 transition">-0.5s</button>
                    <span id="offset-display" class="text-[10px] font-mono text-gray-400 w-10 text-center">0.0s</span>
                    <button onclick="adjustTime(0.5)" class="text-[10px] bg-gray-800 border border-gray-600 text-white w-8 h-8 rounded hover:border-neonCyan hover:text-neonCyan active:scale-95 transition">+0.5s</button>
                </div>

                <!-- Botón Principal -->
                <button id="btn-sync-toggle" onclick="toggleSync()" class="bg-black border-2 border-neonCyan text-neonCyan px-6 py-2 rounded shadow-[0_0_15px_rgba(0,243,255,0.3)] font-bold uppercase tracking-widest text-sm hover:bg-neonCyan hover:text-black transition transform active:scale-95 flex items-center gap-2">
                    <i class="fa-solid fa-play"></i> INICIAR LETRA
                </button>

                <!-- Stop -->
                <button onclick="stopSync()" class="text-gray-500 hover:text-red-500 px-3 transition">
                    <i class="fa-solid fa-stop"></i>
                </button>
            </div>
            <p class="text-[9px] text-center text-gray-500 mt-2 tracking-widest">
                1. DALE PLAY A SPOTIFY &nbsp;|&nbsp; 2. DALE PLAY AQUÍ AL ESCUCHAR LA INTRO
            </p>
        </div>
    </div>

    <script>
        // === DATOS MERGEADOS (INGLÉS Y ESPAÑOL) ===
        // Tiempos exactos provistos por el usuario
        const lyricsData = [
            // INTRO
            { time: 11, type: 'lyric', textEn: "(INTRO) Shhh... don't fight it. It's too late.", textEs: "(INTRO) Shhh... no luches. Es demasiado tarde." },
            
            // VERSE 1
            { time: 20, type: 'lyric', textEn: "(VERSE 1) You don't have to think, I'm the voice in your head.", textEs: "(VERSO 1) No tienes que pensar, soy la voz en tu cabeza." },
            { time: 24, type: 'lyric', textEn: "Every doubt that you had has been silenced and fled.", textEs: "Cada duda que tenías fue silenciada y huyó." },
            { time: 28, type: 'lyric', textEn: "Every step that you take is a path that I laid.", textEs: "Cada paso que das es un camino que yo tracé." },
            { time: 32, type: 'lyric', textEn: "You are right where I want you, a part you have played.", textEs: "Estás justo donde te quiero, un papel que has jugado." },

            // PRE-CHORUS 1
            { time: 35, type: 'section', textEn: "(PRE-CHORUS) You feel the impulse, don't know where it began.", textEs: "(PRE-CORO) Sientes el impulso, no sabes dónde empezó." },
            { time: 39, type: 'lyric', textEn: "That thought in your mind is part of my plan.", textEs: "Ese pensamiento en tu mente es parte de mi plan." },
            { time: 43, type: 'lyric', textEn: "You think it's your choice, so precious and true.", textEs: "Crees que es tu elección, tan preciosa y real." },
            { time: 46, type: 'lyric', textEn: "But my will is the whisper that's pushing you through.", textEs: "Pero mi voluntad es el susurro que te empuja." },

            // CHORUS 1
            { time: 50, type: 'section', textEn: "(CHORUS) I don't ask you to kneel, I don't demand you to follow.", textEs: "(CORO) No te pido que te arrodilles, no te exijo que me sigas." },
            { time: 57, type: 'lyric', textEn: "You just breathe to my tempo... and you need me.", textEs: "Solo respiras a mi ritmo... y me necesitas." },
            { time: 65, type: 'lyric', textEn: "I don't ask you to kneel, I don't demand you to follow.", textEs: "No te pido que te arrodilles, no te exijo que me sigas." },
            { time: 72, type: 'lyric', textEn: "You are dancing to my tempo... you can't help it.", textEs: "Estás bailando a mi ritmo... no puedes evitarlo." },

            // VERSE 2
            { time: 82, type: 'lyric', textEn: "(VERSE 2) Your friends see the warning, it's there in your gaze.", textEs: "(VERSO 2) Tus amigos ven la alerta, está ahí en tu mirada." },
            { time: 85, type: 'lyric', textEn: "A different kind of sparkle, a programmed-out haze.", textEs: "Un brillo diferente, una neblina programada." },
            { time: 88, type: 'lyric', textEn: "You tell them you're fine, you've never felt so free.", textEs: "Les dices que estás bien, nunca te sentiste tan libre." },
            { time: 91, type: 'lyric', textEn: "But my name on your lips is your one decree.", textEs: "Pero mi nombre en tus labios es tu único decreto." },

            // PRE-CHORUS 2
            { time: 97, type: 'section', textEn: "(PRE-CHORUS) You feel the impulse, don't know where it began.", textEs: "(PRE-CORO) Sientes el impulso, no sabes dónde empezó." },
            { time: 101, type: 'lyric', textEn: "That thought in your mind is part of my plan.", textEs: "Ese pensamiento en tu mente es parte de mi plan." },
            { time: 105, type: 'lyric', textEn: "You think it's your choice, so precious and true.", textEs: "Crees que es tu elección, tan preciosa y real." },
            { time: 108, type: 'lyric', textEn: "But my will is the whisper that's pushing you through.", textEs: "Pero mi voluntad es el susurro que te empuja." },

            // CHORUS 2
            { time: 113, type: 'section', textEn: "(CHORUS) I don't ask you to kneel, I don't demand you to follow.", textEs: "(CORO) No te pido que te arrodilles, no te exijo que me sigas." },
            { time: 120, type: 'lyric', textEn: "You just breathe to my tempo... and you need me.", textEs: "Solo respiras a mi ritmo... y me necesitas." },
            { time: 128, type: 'lyric', textEn: "I don't ask you to kneel, I don't demand you to follow.", textEs: "No te pido que te arrodilles, no te exijo que me sigas." },
            { time: 135, type: 'lyric', textEn: "Estás bailando a mi ritmo... no puedes evitarlo.", textEs: "Estás bailando a mi ritmo... no puedes evitarlo." },

            // BRIDGE
            { time: 146, type: 'section', textEn: "(BRIDGE) I'm the gravity in your voice, The echo deep inside.", textEs: "(PUENTE) Soy la gravedad en tu voz, el eco en lo profundo." },
            { time: 150, type: 'lyric', textEn: "There's no force in the world that can offer a choice,", textEs: "No hay fuerza en el mundo que ofrezca elección," },
            { time: 154, type: 'lyric', textEn: "From the invisible thread where you're tied.", textEs: "Desde el hilo invisible donde estás atado." },

            // OUTRO
            { time: 163, type: 'section', textEn: "(OUTRO) I don't ask you to kneel... (ask you to kneel...)", textEs: "(OUTRO) No pido que te arrodilles... (que te arrodilles...)" },
            { time: 170, type: 'lyric', textEn: "I don't demand you to follow... (demand you to follow...)", textEs: "No exijo que me sigas... (que me sigas...)" },
            { time: 180, type: 'lyric', textEn: "I don't ask... I don't demand...", textEs: "No pido... No exijo..." },
            { time: 190, type: 'lyric', textEn: "I don't ask you to kneel...", textEs: "No te pido que te arrodilles..." }
        ];

        const musicLinks = {
            spotify_id: "4QjVTcm14IcFnFCRAzb7Nr", 
            apple_embed: "https://embed.music.apple.com/us/album/my-tempo/123456789?i=123456789",
        };

        let currentLang = 'en';
        let isSyncing = false;
        let startTime = 0;
        let offset = 0; 
        let timerInterval;
        let lastActiveIndex = -1;

        // UI Elements
        const lyricsContainer = document.getElementById('lyrics-content');
        const btnSync = document.getElementById('btn-sync-toggle');
        const offsetDisplay = document.getElementById('offset-display');
        const langToggle = document.getElementById('lang-toggle');

        // === INICIO ===
        function renderLyrics() {
            lyricsContainer.innerHTML = '';
            lyricsData.forEach((line, index) => {
                const el = document.createElement('div');
                el.id = `line-${index}`;
                
                // Aplicar estilos
                if (line.textEn.includes('CHORUS') || line.textEn.includes('CORO')) {
                    el.className = 'lyric-line text-neonPink font-bold'; 
                } else if (line.textEn.includes('INTRO') || line.textEn.includes('BRIDGE')) {
                    el.className = 'lyric-line text-neonCyan';
                } else {
                    el.className = 'lyric-line';
                }

                // Texto según idioma
                el.innerText = currentLang === 'en' ? line.textEn : line.textEs;
                
                // Click para saltar (DEBUG o AJUSTE RÁPIDO)
                el.onclick = () => jumpToTime(line.time);
                
                lyricsContainer.appendChild(el);
            });
            
            // Espaciador final
            const spacer = document.createElement('div');
            spacer.style.height = "30vh";
            lyricsContainer.appendChild(spacer);
        }

        // Cargar iframe
        function loadEmbed(platform) {
            document.getElementById('platform-selector').style.display = 'none';
            document.getElementById('player-container').classList.remove('hidden');
            document.getElementById('lyrics-wrapper').classList.remove('hidden');
            document.getElementById('sync-panel').classList.remove('hidden');
            document.getElementById('canvas-video').style.opacity = "0.3";

            renderLyrics();

            const frame = document.getElementById('embed-frame');
            if(platform === 'spotify') {
                frame.innerHTML = `<iframe style="border-radius:12px" src="https://open.spotify.com/embed/album/${musicLinks.spotify_id}?utm_source=generator&theme=0" width="100%" height="80" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>`;
            } else if (platform === 'apple') {
                frame.innerHTML = `<iframe allow="autoplay *; encrypted-media *; fullscreen *; clipboard-write" frameborder="0" height="80" style="width:100%;max-width:660px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="${musicLinks.apple_embed}"></iframe>`;
            } else {
                frame.innerHTML = `<div class="text-white text-xs p-4 text-center">Reproductor externo cargado.</div>`;
            }
        }

        // === SINCRONIZACIÓN ===
        function toggleSync() {
            if (isSyncing) stopSync();
            else startSync();
        }

        function startSync() {
            isSyncing = true;
            // Guardamos el momento exacto en que se dio click
            // Si el usuario da click justo cuando empieza la Intro (11s), ajustamos el startTime
            // Asumimos que el usuario da click al INICIO (0s) o ajustamos manualmente.
            // Para simplificar: Click = Tiempo 0 de la canción. 
            // Si quieren sincronizar a mitad, usan los botones de salto.
            startTime = Date.now(); 
            
            btnSync.innerHTML = '<i class="fa-solid fa-pause"></i> DETENER';
            btnSync.classList.replace('text-neonCyan', 'text-black');
            btnSync.classList.replace('bg-black', 'bg-neonCyan');

            timerInterval = requestAnimationFrame(updateLoop);
        }

        function stopSync() {
            isSyncing = false;
            cancelAnimationFrame(timerInterval);
            startTime = 0;
            offset = 0;
            offsetDisplay.innerText = "0.0s";
            
            btnSync.innerHTML = '<i class="fa-solid fa-play"></i> INICIAR LETRA';
            btnSync.classList.replace('text-black', 'text-neonCyan');
            btnSync.classList.replace('bg-neonCyan', 'bg-black');

            document.querySelectorAll('.active').forEach(el => el.classList.remove('active'));
            document.getElementById('progress-bar').style.width = '0%';
        }

        function updateLoop() {
            if (!isSyncing) return;

            const now = Date.now();
            const currentTime = ((now - startTime) / 1000) + offset;

            // Buscar línea activa
            let activeIndex = -1;
            for (let i = 0; i < lyricsData.length; i++) {
                if (currentTime >= lyricsData[i].time) {
                    activeIndex = i;
                }
            }

            if (activeIndex !== lastActiveIndex) {
                // Remover clase anterior
                document.querySelectorAll('.active').forEach(el => el.classList.remove('active'));
                
                if (activeIndex !== -1) {
                    const el = document.getElementById(`line-${activeIndex}`);
                    if (el) {
                        el.classList.add('active');
                        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
                lastActiveIndex = activeIndex;
            }

            requestAnimationFrame(updateLoop);
        }

        // === HERRAMIENTAS ===
        function adjustTime(val) {
            offset += val; // Sumar o restar segundos al tiempo calculado
            const sign = offset > 0 ? '+' : '';
            offsetDisplay.innerText = `${sign}${offset.toFixed(1)}s`;
            offsetDisplay.style.color = offset === 0 ? '#9ca3af' : '#00f3ff';
            
            // Reforzar actualización inmediata
            if(lastActiveIndex !== -1) {
                 const el = document.getElementById(`line-${lastActiveIndex}`);
                 if(el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function jumpToTime(sec) {
            if(!isSyncing) startSync();
            // Recalcular startTime para que (now - startTime) resulte en 'sec'
            startTime = Date.now() - (sec * 1000);
            offset = 0; 
            offsetDisplay.innerText = "0.0s";
        }

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'es' : 'en';
            langToggle.innerText = currentLang === 'en' ? 'EN / ES' : 'ES / EN';
            renderLyrics(); // Re-renderizar texto
            
            // Recuperar estado activo visualmente inmediatamente
            if (isSyncing && lastActiveIndex !== -1) {
                const el = document.getElementById(`line-${lastActiveIndex}`);
                if (el) {
                    el.classList.add('active');
                    el.scrollIntoView({ behavior: 'auto', block: 'center' });
                }
            }
        }

        function resetPlayer() {
            stopSync();
            document.getElementById('platform-selector').style.display = 'block';
            document.getElementById('player-container').classList.add('hidden');
            document.getElementById('lyrics-wrapper').classList.add('hidden');
            document.getElementById('sync-panel').classList.add('hidden');
            document.getElementById('embed-frame').innerHTML = '';
            document.getElementById('canvas-video').style.opacity = "0.5";
        }
    </script>
</body>
</html>
