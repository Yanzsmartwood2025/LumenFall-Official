<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY TEMPO | Lumenfall Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'display': ['Impact', 'Arial Black', 'sans-serif'],
                        'mono': ['Courier New', 'monospace'],
                    },
                    colors: {
                        neonCyan: '#00f3ff',
                        neonPink: '#ff00ff',
                    }
                },
            },
        };
    </script>

    <style>
        body { background-color: #000; color: white; overflow: hidden; margin: 0; }
        
        /* Video de Fondo */
        #canvas-video {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: -1; opacity: 0.5;
            filter: brightness(0.6) contrast(1.2);
        }

        /* --- CONTENEDOR KARAOKE --- */
        .contenedor-karaoke {
            background-color: rgba(0, 0, 0, 0.6); 
            backdrop-filter: blur(5px);
            width: 95%; 
            max-width: 800px;
            margin: 10px auto;
            border-top: 1px solid #00ffff;
            border-bottom: 1px solid #00ffff;
            font-family: 'Courier New', monospace;
            text-align: center;
            position: relative;
            box-sizing: border-box;
            padding: 15px 5px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.1);
            transition: background-color 0.5s;
        }

        /* --- ESTADO 1: LETRA NORMAL (VISIBILIDAD TOTAL) --- */
        .linea-lyric {
            display: block;
            margin: 14px 0;
            /* CAMBIO: Letra Blanca y visible por defecto */
            color: #ffffff; 
            font-size: 16px; 
            transition: all 0.4s ease-out;
            opacity: 0.9; /* Casi 100% visible */
            filter: blur(0px); /* Sin desenfoque */
            padding: 5px 10px;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        /* Efecto Hover suave en PC */
        .linea-lyric:hover {
            opacity: 1;
            text-shadow: 0 0 5px white;
        }

        /* --- ESTADO 2: LETRA ACTIVA (ENCENDIDA) --- */
        .linea-activa {
            color: #00ffff !important;
            font-size: 24px !important;
            font-weight: 900;
            opacity: 1 !important;
            filter: blur(0px) !important;
            transform: scale(1.05);
            text-shadow: 0 0 15px #00ffff, 0 0 30px #000;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 8px;
            padding: 15px 5px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
            width: 100%;
        }

        /* --- ESTADO 3: MODO AUTO (OSCURECER LAS OTRAS) --- */
        /* Esta clase se agrega al contenedor padre cuando inicia el Auto-Sync */
        .modo-automatico .linea-lyric:not(.linea-activa) {
            opacity: 0.3;     /* Aquí sí se apagan las que no se cantan */
            filter: blur(2px); /* Se desenfocan un poco */
            color: #aaa;
            transform: scale(0.95);
        }

        /* Botón Principal */
        .btn-sync {
            background: rgba(0,0,0,0.5);
            border: 1px solid #00ffff;
            color: #fff;
            padding: 12px 0;
            width: 100%;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 15px;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
            transition: all 0.3s;
        }
        .btn-sync:hover { background: #00ffff; color: #000; }
        
        /* Scroll Box */
        #lyrics-box {
            height: 50vh;
            overflow-y: auto;
            scroll-behavior: smooth;
            padding-bottom: 150px;
            scrollbar-width: none; 
        }
        #lyrics-box::-webkit-scrollbar { display: none; }

        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex flex-col h-screen relative">

    <!-- Video Fondo -->
    <video id="canvas-video" autoplay loop muted playsinline>
        <source src="../assets/flama-bg.mp4" type="video/mp4"> 
    </video>

    <!-- Botón Regresar -->
    <a href="../index.html" class="absolute top-6 left-6 text-white/50 hover:text-neonCyan transition z-50 bg-black/20 p-2 rounded-full backdrop-blur-sm">
        <i class="fa-solid fa-arrow-left text-xl"></i>
    </a>

    <div class="flex-grow flex flex-col items-center justify-start px-4 z-10 w-full max-w-md mx-auto mt-4 pt-4">
        
        <!-- Header -->
        <div class="text-center mb-2 fade-in-up flex items-center gap-4 w-full justify-center">
            <div class="w-16 h-16 rounded shadow-[0_0_15px_rgba(0,243,255,0.2)] overflow-hidden border border-white/20">
                <img src="../assets/imagenes/LUMENFALL-JUEGO-512x512.png" onerror="this.src='https://via.placeholder.com/150/000000/00f3ff?text=LF'" class="w-full h-full object-cover">
            </div>
            <div class="text-left">
                <h1 class="font-display text-2xl tracking-widest text-white drop-shadow-lg leading-none">MY TEMPO</h1>
                <p class="text-neonCyan font-mono text-xs tracking-[0.3em]">JOZIEL</p>
            </div>
        </div>

        <!-- Selector Plataformas -->
        <div id="platform-selector" class="w-full mb-2 fade-in-up">
            <div class="grid grid-cols-4 gap-2">
                <button onclick="loadEmbed('spotify')" class="bg-[#1DB954]/20 border border-[#1DB954] hover:bg-[#1DB954] text-white p-2 rounded-lg transition flex justify-center items-center"><i class="fa-brands fa-spotify text-xl"></i></button>
                <button onclick="loadEmbed('apple')" class="bg-[#FA243C]/20 border border-[#FA243C] hover:bg-[#FA243C] text-white p-2 rounded-lg transition flex justify-center items-center"><i class="fa-brands fa-apple text-xl"></i></button>
                <button onclick="loadEmbed('deezer')" class="bg-white/10 border border-white hover:bg-white text-white p-2 rounded-lg transition flex justify-center items-center"><i class="fa-brands fa-deezer text-xl"></i></button>
                <button onclick="loadEmbed('amazon')" class="bg-[#00A8E1]/20 border border-[#00A8E1] hover:bg-[#00A8E1] text-white p-2 rounded-lg transition flex justify-center items-center"><i class="fa-brands fa-amazon text-xl"></i></button>
            </div>
        </div>

        <!-- Reproductor -->
        <div id="player-container" class="w-full hidden fade-in-up mb-2 relative">
            <div class="flex justify-between items-center mb-1 px-1">
                <button onclick="resetPlayer()" class="text-[10px] text-gray-400 hover:text-white uppercase"><i class="fa-solid fa-xmark mr-1"></i> Cerrar</button>
                <button id="lang-toggle" onclick="toggleLanguage()" class="text-[10px] border border-neonCyan text-neonCyan bg-black/50 px-3 py-1 rounded hover:bg-neonCyan hover:text-black transition uppercase font-bold">EN / ES</button>
            </div>
            <div id="embed-frame" class="rounded-xl overflow-hidden bg-black min-h-[80px]"></div>
        </div>

        <!-- KARAOKE WRAPPER -->
        <div id="karaoke-wrapper" class="w-full fade-in-up hidden">
            <div id="main-container" class="contenedor-karaoke">
                <p style="color:#aaa; font-size:10px; margin-bottom:8px; letter-spacing:1px; font-family: sans-serif;">
                    1. PLAY EN APP &nbsp;|&nbsp; 2. ACTIVA SYNC
                </p>

                <button id="btn-start" class="btn-sync" type="button">
                    <i class="fa-solid fa-bolt mr-2"></i> ACTIVAR AUTO-SYNC
                </button>
                
                <div id="lyrics-box"></div>
            </div>

            <!-- Botones Ajuste -->
            <div class="flex justify-center gap-4 mt-2">
                <button onclick="adjustTime(-0.5)" class="text-xs text-gray-400 hover:text-neonPink p-2 border border-white/20 rounded bg-black/40">-0.5s</button>
                <button onclick="adjustTime(0.5)" class="text-xs text-gray-400 hover:text-neonCyan p-2 border border-white/20 rounded bg-black/40">+0.5s</button>
            </div>
        </div>

    </div>

    <script>
        // === DATOS DE LETRAS (MERGEADOS) ===
        const lyricsData = [
            { time: 11, textEn: "(INTRO) Shhh... don't fight it. It's too late.", textEs: "(INTRO) Shhh... no luches. Es demasiado tarde." },
            { time: 20, textEn: "(VERSE 1) You don't have to think, I'm the voice in your head.", textEs: "(VERSO 1) No tienes que pensar, soy la voz en tu cabeza." },
            { time: 24, textEn: "Every doubt that you had has been silenced and fled.", textEs: "Cada duda que tenías fue silenciada y huyó." },
            { time: 28, textEn: "Every step that you take is a path that I laid.", textEs: "Cada paso que das es un camino que yo tracé." },
            { time: 32, textEn: "You are right where I want you, a part you have played.", textEs: "Estás justo donde te quiero, un papel que has jugado." },
            { time: 35, textEn: "(PRE-CHORUS) You feel the impulse, don't know where it began.", textEs: "(PRE-CORO) Sientes el impulso, no sabes dónde empezó." },
            { time: 39, textEn: "That thought in your mind is part of my plan.", textEs: "Ese pensamiento en tu mente es parte de mi plan." },
            { time: 43, textEn: "You think it's your choice, so precious and true.", textEs: "Crees que es tu elección, tan preciosa y real." },
            { time: 46, textEn: "But my will is the whisper that's pushing you through.", textEs: "Pero mi voluntad es el susurro que te empuja." },
            { time: 50, textEn: "(CHORUS) I don't ask you to kneel, I don't demand you to follow.", textEs: "(CORO) No te pido que te arrodilles, no te exijo que me sigas." },
            { time: 57, textEn: "You just breathe to my tempo... and you need me.", textEs: "Solo respiras a mi ritmo... y me necesitas." },
            { time: 65, textEn: "I don't ask you to kneel, I don't demand you to follow.", textEs: "No te pido que te arrodilles, no te exijo que me sigas." },
            { time: 72, textEn: "You are dancing to my tempo... you can't help it.", textEs: "Estás bailando a mi ritmo... no puedes evitarlo." },
            { time: 82, textEn: "(VERSE 2) Your friends see the warning, it's there in your gaze.", textEs: "(VERSO 2) Tus amigos ven la alerta, está ahí en tu mirada." },
            { time: 85, textEn: "A different kind of sparkle, a programmed-out haze.", textEs: "Un brillo diferente, una neblina programada." },
            { time: 88, textEn: "You tell them you're fine, you've never felt so free.", textEs: "Les dices que estás bien, nunca te sentiste tan libre." },
            { time: 91, textEn: "But my name on your lips is your one decree.", textEs: "Pero mi nombre en tus labios es tu único decreto." },
            { time: 97, textEn: "(PRE-CHORUS) You feel the impulse, don't know where it began.", textEs: "(PRE-CORO) Sientes el impulso, no sabes dónde empezó." },
            { time: 101, textEn: "That thought in your mind is part of my plan.", textEs: "Ese pensamiento en tu mente es parte de mi plan." },
            { time: 105, textEn: "You think it's your choice, so precious and true.", textEs: "Crees que es tu elección, tan preciosa y real." },
            { time: 108, textEn: "But my will is the whisper that's pushing you through.", textEs: "Pero mi voluntad es el susurro que te empuja." },
            { time: 113, textEn: "(CHORUS) I don't ask you to kneel, I don't demand you to follow.", textEs: "(CORO) No te pido que te arrodilles, no te exijo que me sigas." },
            { time: 120, textEn: "You just breathe to my tempo... and you need me.", textEs: "Solo respiras a mi ritmo... y me necesitas." },
            { time: 128, textEn: "I don't ask you to kneel, I don't demand you to follow.", textEs: "No te pido que te arrodilles, no te exijo que me sigas." },
            { time: 135, textEn: "You are dancing to my tempo... you can't help it.", textEs: "Estás bailando a mi ritmo... no puedes evitarlo." },
            { time: 146, textEn: "(BRIDGE) I'm the gravity in your voice, The echo deep inside.", textEs: "(PUENTE) Soy la gravedad en tu voz, el eco en lo profundo." },
            { time: 150, textEn: "There's no force in the world that can offer a choice,", textEs: "No hay fuerza en el mundo que ofrezca elección," },
            { time: 154, textEn: "From the invisible thread where you're tied.", textEs: "Desde el hilo invisible donde estás atado." },
            { time: 163, textEn: "(OUTRO) I don't ask you to kneel... (ask you to kneel...)", textEs: "(OUTRO) No pido que te arrodilles... (que te arrodilles...)" },
            { time: 170, textEn: "I don't demand you to follow... (demand you to follow...)", textEs: "No exijo que me sigas... (que me sigas...)" },
            { time: 180, textEn: "I don't ask... I don't demand...", textEs: "No pido... No exijo..." },
            { time: 190, textEn: "I don't ask you to kneel...", textEs: "No te pido que te arrodilles..." }
        ];

        const musicLinks = {
            spotify_id: "4QjVTcm14IcFnFCRAzb7Nr", 
            apple_embed: "https://embed.music.apple.com/us/album/my-tempo/123456789?i=123456789",
        };

        // Variables Globales
        let currentLang = 'en'; // Inglés por defecto en los datos que pasaste
        let audioTimer = null;
        let startTime = 0;
        let offset = 0;
        let autoMode = false;

        const caja = document.getElementById('lyrics-box');
        const boton = document.getElementById('btn-start');
        const mainContainer = document.getElementById('main-container');

        // 1. RENDERIZADO (MODO MANUAL VISIBLE)
        function renderLyrics() {
            caja.innerHTML = ''; 
            lyricsData.forEach((line, index) => {
                let div = document.createElement('div');
                div.className = 'linea-lyric';
                div.id = 'linea-' + index;
                div.innerText = currentLang === 'en' ? line.textEn : line.textEs;
                
                // EVENTO MANUAL
                div.addEventListener('click', function() {
                    // Si NO estamos en automático, permitir encender manualmente
                    if (!autoMode) {
                        document.querySelectorAll('.linea-activa').forEach(l => l.classList.remove('linea-activa'));
                        this.classList.add('linea-activa');
                        this.scrollIntoView({ behavior: "smooth", block: "center" });
                    } else {
                        // Si ESTAMOS en automático, click = saltar a ese tiempo
                        jumpToTime(line.time);
                    }
                });
                
                caja.appendChild(div);
            });
            // Espacio final
            let spacer = document.createElement('div');
            spacer.style.height = "250px";
            caja.appendChild(spacer);
        }

        // 2. CICLO AUTOMÁTICO
        function cicloDeJuego() {
            let segundosActuales = ((Date.now() - startTime) / 1000) + offset;
            
            let lineaActivaIndex = -1;
            for (let i = 0; i < lyricsData.length; i++) {
                if (segundosActuales >= lyricsData[i].time) {
                    lineaActivaIndex = i;
                }
            }

            if (lineaActivaIndex !== -1) {
                const lineaActualEl = document.getElementById('linea-' + lineaActivaIndex);
                if (lineaActualEl && !lineaActualEl.classList.contains('linea-activa')) {
                    document.querySelectorAll('.linea-activa').forEach(el => el.classList.remove('linea-activa'));
                    lineaActualEl.classList.add('linea-activa');
                    lineaActualEl.scrollIntoView({ behavior: "smooth", block: "center" });
                }
            }
        }

        // 3. CONTROL BOTÓN
        boton.addEventListener('click', function() {
            if (autoMode) {
                // DETENER / RESETEAR
                clearInterval(audioTimer);
                autoMode = false;
                mainContainer.classList.remove('modo-automatico'); // Quitar efecto oscuro
                
                boton.innerHTML = '<i class="fa-solid fa-bolt mr-2"></i> ACTIVAR AUTO-SYNC';
                boton.style.borderColor = "#00ffff";
                boton.style.color = "white";
                
                // Limpiar activa para volver a estado "Todo Blanco"
                document.querySelectorAll('.linea-activa').forEach(l => l.classList.remove('linea-activa'));
                caja.scrollTop = 0;
            } else {
                // INICIAR
                autoMode = true;
                startTime = Date.now();
                offset = 0;
                
                mainContainer.classList.add('modo-automatico'); // Activar efecto oscuro
                
                boton.innerHTML = '◼ DETENER SYNC';
                boton.style.borderColor = "#ff0055"; 
                boton.style.color = "#ff0055";
                
                audioTimer = setInterval(cicloDeJuego, 100);
            }
        });

        // 4. FUNCIONES DE APOYO
        function loadEmbed(platform) {
            document.getElementById('platform-selector').style.display = 'none';
            document.getElementById('player-container').classList.remove('hidden');
            document.getElementById('karaoke-wrapper').classList.remove('hidden');
            document.getElementById('canvas-video').style.opacity = "0.3";

            const frame = document.getElementById('embed-frame');
            if(platform === 'spotify') {
                frame.innerHTML = `<iframe style="border-radius:12px" src="https://open.spotify.com/embed/album/${musicLinks.spotify_id}?utm_source=generator&theme=0" width="100%" height="80" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>`;
            } else if (platform === 'apple') {
                frame.innerHTML = `<iframe allow="autoplay *; encrypted-media *; fullscreen *; clipboard-write" frameborder="0" height="80" style="width:100%;max-width:660px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="${musicLinks.apple_embed}"></iframe>`;
            }
            renderLyrics();
        }

        function resetPlayer() {
            if(audioTimer) clearInterval(audioTimer);
            autoMode = false;
            mainContainer.classList.remove('modo-automatico');
            document.getElementById('platform-selector').style.display = 'block';
            document.getElementById('player-container').classList.add('hidden');
            document.getElementById('karaoke-wrapper').classList.add('hidden');
            document.getElementById('embed-frame').innerHTML = '';
            document.getElementById('canvas-video').style.opacity = "0.5";
        }

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'es' : 'en';
            renderLyrics();
            // Restaurar estado visual
            if(autoMode) cicloDeJuego();
        }

        function adjustTime(val) {
            offset += val;
        }
        
        function jumpToTime(sec) {
            if(!autoMode) return; 
            startTime = Date.now() - (sec * 1000);
            offset = 0;
            // Forzar actualización inmediata visual
            cicloDeJuego();
        }

    </script>
</body>
</html>
