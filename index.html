<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUMENFALL - El Atrio</title>
    
    <!-- Open Graph Meta Tags (para Redes Sociales) -->
    <meta property="og:title" content="LUMENFALL - El Atrio">
    <meta property="og:description" content="El universo 'Lumenfall'. Activos oficiales del demo, el lore y la marca Joziel.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="assets/imagenes/LUMENFALL-JUEGO-512x512.png">
    
    <!-- Apple Touch Icons (para iOS / iPhone / iPad) -->
    <link rel="apple-touch-icon" href="assets/imagenes/LUMENFALL-JUEGO-180x180.png">
    <link rel="apple-touch-icon" sizes="120x120" href="assets/imagenes/LUMENFALL-JUEGO-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="assets/imagenes/LUMENFALL-JUEGO-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="assets/imagenes/LUMENFALL-JUEGO-152x152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="assets/imagenes/LUMENFALL-JUEGO-167x167.png">

    <!-- Metas para PWA -->
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.json">

    <!-- Cargar Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuración personalizada de Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                        'display': ['Impact', 'Arial Black', 'sans-serif'], // Fuente dramática
                    },
                },
            },
        };
    </script>

    <style>
        /* Importar la fuente de Google para la firma */
        @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap');

        /* Estilo base */
        body {
            font-family: 'Inter', sans-serif;
            overscroll-behavior: none;
        }

        /* --- FASE 1: Estilos del Splash Screen --- */
        
        #splash-screen {
            transition: opacity 0.5s ease-in-out;
        }
        
        #splash-screen.fade-out {
            opacity: 0;
        }
        
        /* --- FASE 2: Estilos de la Página Principal --- */

        #bg-video-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        #bg-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: blur(8px) brightness(0.4); 
        }
        
        #main-content {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
    </style>
</head>

<body class="bg-black text-white antialiased">

    <!-- FASE 1: Splash Screen -->
    <div id="splash-screen" class="fixed inset-0 bg-black z-50 flex items-center justify-center">
        <img src="assets/imagenes/icono-inicio-web/icono-joziel-2.png" alt="Joziel" class="max-w-[80%] max-h-[80%] object-contain">
    </div>

    <!-- FASE 2: Contenido Principal -->
    <div id="main-content" class="relative z-10 min-h-screen flex flex-col">
        
        <!-- Contenedor del Video de Fondo -->
        <div id="bg-video-container">
            <video id="bg-video" autoplay muted loop playsinline>
                <source src="assets/flama-bg.mp4" type="video/mp4">
                Tu navegador no soporta el video de fondo.
            </video>
        </div>

        <!-- Contenido de la página -->
        <div class="flex-grow flex flex-col items-center justify-center p-4 sm:p-8">

            <!-- Encabezado con el Título -->
            <header class="text-center my-8 sm:my-10">
                <h1 class="text-6xl sm:text-7xl md:text-9xl">
                    <img src="assets/imagenes/Icono-inicio.png" alt="Lumenfall Logo" class="mx-auto w-full max-w-lg md:max-w-2xl h-auto">
                </h1>
            </header>

            <!-- Contenedor de Autenticación -->
            <section id="auth-container" class="w-full max-w-sm mx-auto my-6 text-center">
                
                <div id="login-buttons" class="space-y-4">
                    
                    <button id="install-pwa-button" class="w-full flex items-center justify-center p-3 rounded-lg font-semibold transition-colors duration-200 bg-teal-500 text-white hover:bg-teal-600 hidden">
                        <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                        </svg>
                        Instalar Aplicación
                    </button>

                    <button id="google-login" class="w-full flex items-center justify-center p-3 rounded-lg font-semibold transition-colors duration-200 bg-white text-gray-800 hover:bg-gray-200">
                        <svg class="w-5 h-5 mr-3" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M43.6111 20.0833H42V20H24V28H35.303C33.6747 32.6596 29.2235 36 24 36C17.373 36 12 30.627 12 24C12 17.373 17.373 12 24 12C26.8543 12 29.4312 13.1118 31.3914 14.888L36.0121 10.2672C32.6393 7.2898 28.5363 5.5 24 5.5C13.797 5.5 5.5 13.797 5.5 24C5.5 34.203 13.797 42.5 24 42.5C34.203 42.5 42.5 34.203 42.5 24C42.5 22.6105 42.3699 21.3533 42.126 20.1388L43.6111 20.0833Z" fill="#FFC107"></path><path d="M43.6111 20.0833H42V20H24V28H35.303C34.5102 30.4187 33.1594 32.5539 31.3914 34.1118L36.0121 38.7328C39.4239 35.034 42.5 29.16 42.5 24C42.5 22.6105 42.3699 21.3533 42.126 20.1388L43.6111 20.0833Z" fill="#FF3D00"></path><path d="M24 5.5C28.5363 5.5 32.6393 7.2898 36.0121 10.2672L31.3914 14.888C29.4312 13.1118 26.8543 12 24 12C20.6974 12 17.817 13.4357 16.0352 15.6961L11.0264 11.8346C14.3315 8.1636 18.892 5.5 24 5.5Z" fill="#4CAF50"></path><path d="M43.6111 20.0833L42.126 20.1388C42.3699 21.3533 42.5 22.6105 42.5 24C42.5 29.16 39.4239 35.034 36.0121 38.7328L31.3914 34.1118C33.1594 32.5539 34.5102 30.4187 35.303 28H24V20H42V20.0833H43.6111Z" fill="#1976D2"></path></svg>
                        Iniciar con Google
                    </button>
                    <button id="facebook-login" class="w-full flex items-center justify-center p-3 rounded-lg font-semibold transition-colors duration-200 bg-blue-600 text-white hover:bg-blue-700">
                        <svg class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.04C6.5 2.04 2 6.53 2 12.06C2 17.06 5.66 21.21 10.44 21.96V14.96H7.9V12.06H10.44V9.81C10.44 7.31 11.93 5.96 14.22 5.96C15.31 5.96 16.45 6.15 16.45 6.15V8.62H15.19C13.95 8.62 13.56 9.39 13.56 10.18V12.06H16.34L15.89 14.96H13.56V21.96C18.34 21.21 22 17.06 22 12.06C22 6.53 17.5 2.04 12 2.04Z"></path></svg>
                        Iniciar con Facebook
                    </button>
                </div>
                
                <div id="user-info" class="hidden space-y-4">
                    <div class="bg-gray-800 p-4 rounded-lg border border-gray-600">
                        <p class="text-gray-400 text-xs uppercase tracking-widest mb-1">Operador Conectado</p>
                        <p id="user-email" class="text-white font-bold text-sm break-all mb-4"></p>

                        <!-- Bloque para mostrar el Código de Juego -->
                        <div id="game-code-block" class="hidden bg-black/50 p-2 rounded border border-yellow-500/30">
                            <p class="text-yellow-500 text-[10px] font-mono mb-1">CÓDIGO DE ACCESO (NIVEL 1)</p>
                            <p id="game-code-display" class="text-white font-mono text-xl tracking-[0.2em] font-bold">CARGANDO...</p>
                        </div>
                    </div>

                    <button id="logout-button" class="w-full p-3 rounded-lg font-semibold transition-colors duration-200 bg-red-600 text-white hover:bg-red-700">
                        Cerrar Sesión
                    </button>
                </div>
            </section>

            <!-- Navegación Principal -->
            <nav class="w-full max-w-4xl mx-auto my-8 sm:my-10">
                <div class="flex flex-col sm:grid sm:grid-cols-2 sm:gap-6 space-y-6 sm:space-y-0">
                    
                    <a href="./Lumenfall-juego/index.html" class="group block p-4 text-center transition-all duration-300 transform hover:-translate-y-1">
                        <span class="block text-3xl sm:text-4xl font-display uppercase text-white group-hover:text-red-400 transition-colors duration-300 tracking-wider">JUGAR EL DEMO</span>
                        <span class="block text-sm text-gray-400 group-hover:text-gray-300 transition-colors duration-300">(La Experiencia Interactiva)</span>
                    </a>
                    
                    <a href="./Lumenfall-libro/index.html" class="group block p-4 text-center transition-all duration-300 transform hover:-translate-y-1">
                        <span class="block text-3xl sm:text-4xl font-display uppercase text-white group-hover:text-red-400 transition-colors duration-300 tracking-wider">LEER EL LORE</span>
                        <span class="block text-sm text-gray-400 group-hover:text-gray-300 transition-colors duration-300">(El Grimorio / El Diario)</span>
                    </a>
                    
                    <!-- *** CAMBIO AQUÍ: Apuntando a la carpeta correcta 'Armeria' *** -->
                    <a href="./Armeria/index.html" class="group block p-4 text-center transition-all duration-300 transform hover:-translate-y-1">
                        <span class="block text-3xl sm:text-4xl font-display uppercase text-white group-hover:text-red-400 transition-colors duration-300 tracking-wider">LA ARMERÍA</span>
                        <span class="block text-sm text-gray-400 group-hover:text-gray-300 transition-colors duration-300">(Camisetas y Accesorios)</span>
                    </a>
                    
                    <a href="./Musica/index.html" class="group block p-6 sm:p-8 text-center bg-white rounded-lg transition-all duration-300 hover:bg-gray-200 hover:shadow-lg transform hover:-translate-y-1">
                        <span class="block text-xl sm:text-2xl font-bold text-gray-900 group-hover:text-red-500 transition-colors duration-300">LA BANDA SONORA</span>
                        <span class="block text-sm text-gray-600 group-hover:text-red-500 transition-colors duration-300">(Escuchar 'MY TEMPO')</span>
                    </a>

                </div>
            </nav>

        </div>

        <!-- Footer -->
        <footer class="w-full text-center p-6 mt-auto">
            <!-- Iconos de redes sociales -->
            <div class="flex justify-center space-x-8 mb-4">
                
                <!-- Instagram -->
                <a href="https://www.instagram.com/joziel382025" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
                    <img src="assets/imagenes/icono-redes-sociales/instagram.png?v=1" alt="Instagram" class="w-12 h-12 transition-opacity duration-200 hover:opacity-75">
                </a>
                
                <!-- Facebook -->
                <a href="https://www.facebook.com/share/17hdXVWj2B/" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
                    <img src="assets/imagenes/icono-redes-sociales/facebook.png?v=1" alt="Facebook" class="w-12 h-12 transition-opacity duration-200 hover:opacity-75">
                </a>

                <!-- X (Twitter) -->
                <a href="https://x.com/Joziel380" target="_blank" rel="noopener noreferrer" aria-label="X (Twitter)">
                    <img src="assets/imagenes/icono-redes-sociales/x.png?v=1" alt="X (Twitter)" class="w-12 h-12 transition-opacity duration-200 hover:opacity-75">
                </a>

                <!-- TikTok -->
                <a href="https://www.tiktok.com/@joziel38000" target="_blank" rel="noopener noreferrer" aria-label="TikTok">
                    <img src="assets/imagenes/icono-redes-sociales/tik-tok.png?v=1" alt="TikTok" class="w-12 h-12 transition-opacity duration-200 hover:opacity-75">
                </a>
                
                <!-- YouTube -->
                <a href="https://www.youtube.com/@Joziel38000" target="_blank" rel="noopener noreferrer" aria-label="YouTube">
                    <img src="assets/imagenes/icono-redes-sociales/you-tube.png?v=1" alt="YouTube" class="w-12 h-12 transition-opacity duration-200 hover:opacity-75">
                </a>
            </div>
            <p class="text-gray-500 text-sm mb-2">
                <a href="mailto:joziel.official@gmail.com" class="hover:text-gray-300 transition-colors duration-200">
                    joziel.official@gmail.com
                </a>
            </p>
            <p class="text-gray-500 text-sm">&copy; 2025 JUSN38</p>
        </footer>

    </div>
    
    <!-- Lógica del Splash Screen y PWA -->
    <script>
        window.addEventListener('load', () => {
            const splash = document.getElementById('splash-screen');
            const main = document.getElementById('main-content');
            
            // Lógica de Splash Screen
            function hideSplash(duration) {
                try {
                    sessionStorage.setItem('splashSeen', 'true');
                } catch (e) {
                    console.warn('sessionStorage no está disponible.');
                }

                setTimeout(() => {
                    if (splash) {
                        splash.classList.add('fade-out');
                    }
                    if (main) {
                        main.style.opacity = '1';
                    }
                    
                    setTimeout(() => {
                        if (splash) {
                            splash.style.display = 'none';
                        }
                    }, 500);
                }, duration);
            }

            let splashDuration = 4000;
            try {
                if (sessionStorage.getItem('splashSeen') === 'true') {
                    splashDuration = 0; 
                }
            } catch (e) {
                console.warn('sessionStorage no está disponible.');
            }
            
            hideSplash(splashDuration);

            // Lógica de PWA (Service Worker)
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then((registration) => {
                        console.log('Service Worker registrado con éxito:', registration);
                    })
                    .catch((error) => {
                        console.error('Error al registrar el Service Worker:', error);
                    });
            }
        });
    </script>

    <!-- Cargar el Sistema de Autenticación Central (El Breaker) -->
    <script type="module" src="assets/js/auth-core.js"></script>

    <!-- Lógica de UI para Autenticación -->
    <script>
        // Referencias al DOM
        const loginButtons = document.getElementById('login-buttons');
        const userInfo = document.getElementById('user-info');
        const userEmail = document.getElementById('user-email');
        const gameCodeBlock = document.getElementById('game-code-block');
        const gameCodeDisplay = document.getElementById('game-code-display');
        const googleLoginBtn = document.getElementById('google-login');
        const facebookLoginBtn = document.getElementById('facebook-login');
        const logoutBtn = document.getElementById('logout-button');
        const installButton = document.getElementById('install-pwa-button'); 

        // Esperar a que el script de auth se cargue y exponga el objeto global
        // Usamos un intervalo simple para chequear la existencia de LumenfallAuth si fuera necesario,
        // pero como es type="module" y este script es diferido (o posterior), usaremos un evento o
        // confiaremos en que el módulo se ejecute.
        // La mejor manera con módulos es esperar a que LumenfallAuth esté disponible.

        function initUI() {
            if (!window.LumenfallAuth) {
                requestAnimationFrame(initUI);
                return;
            }

            // Conectar botones
            if(googleLoginBtn) googleLoginBtn.onclick = window.LumenfallAuth.loginWithGoogle;
            if(facebookLoginBtn) facebookLoginBtn.onclick = window.LumenfallAuth.loginWithFacebook;
            if(logoutBtn) logoutBtn.onclick = window.LumenfallAuth.logout;

            // Suscribirse a cambios de estado
            window.LumenfallAuth.onStateChanged((user, userData) => {
                if (user) {
                    userEmail.textContent = user.email || 'Agente';
                    loginButtons.classList.add('hidden');
                    userInfo.classList.remove('hidden');

                    if (userData && userData.gameCode) {
                        gameCodeBlock.classList.remove('hidden');
                        gameCodeDisplay.textContent = userData.gameCode;
                    } else {
                        gameCodeBlock.classList.add('hidden');
                    }
                } else {
                    userEmail.textContent = '';
                    gameCodeBlock.classList.add('hidden');
                    loginButtons.classList.remove('hidden');
                    userInfo.classList.add('hidden');
                }
            });
        }

        // Iniciar
        initUI();

        // Prompt de Instalación PWA (Mantenido igual)
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            if(installButton) installButton.classList.remove('hidden');
        });
        if(installButton) {
            installButton.addEventListener('click', async () => {
                installButton.classList.add('hidden');
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    deferredPrompt = null;
                }
            });
        }
        window.addEventListener('appinstalled', () => {
            if(installButton) installButton.classList.add('hidden');
            deferredPrompt = null;
        });
    </script>

</body>
</html>
